<?php
// +----------------------------------------------------------------------
// | JWT配置文件
// +----------------------------------------------------------------------
// | 说明：JWT v2认证系统的全局配置
// +----------------------------------------------------------------------

return [
    // +----------------------------------------------------------------------
    // | JWT密钥配置（非常重要，生产环境必须修改！）
    // +----------------------------------------------------------------------
    // 密钥必须保密，用于签名验证
    // 生产环境建议使用至少32字符的随机字符串
    'secret' => env('JWT_SECRET', 'your-secret-key-change-this-in-production'),

    // +----------------------------------------------------------------------
    // | JWT签发者和受众
    // +----------------------------------------------------------------------
    // 签发者：通常是你的域名或应用标识
    'issuer' => env('JWT_ISSUER', 'your-domain.com'),

    // 受众：通常是你的域名或API标识
    'audience' => env('JWT_AUDIENCE', 'your-domain.com'),

    // +----------------------------------------------------------------------
    // | 签名算法
    // +----------------------------------------------------------------------
    // HS256: HMAC-SHA256（对称加密，开发环境推荐）
    // RS256: RSA-SHA256（非对称加密，生产环境推荐，需要配置公钥和私钥）
    'algorithm' => env('JWT_ALGORITHM', 'HS256'),

    // RSA密钥配置（仅在使用RS256算法时需要）
    'keys' => [
        'private' => env('JWT_PRIVATE_KEY', ''), // 私钥路径或内容
        'public' => env('JWT_PUBLIC_KEY', ''),  // 公钥路径或内容
        'passphrase' => env('JWT_PRIVATE_KEY_PASSPHRASE', ''), // 私钥密码（如果有）
    ],

    // +----------------------------------------------------------------------
    // | 令牌有效期配置（单位：秒）
    // +----------------------------------------------------------------------
    // 访问令牌有效期：默认2小时（7200秒）
    'access_token_ttl' => env('JWT_ACCESS_TOKEN_TTL', 7200),

    // 刷新令牌有效期：默认7天（604800秒）
    'refresh_token_ttl' => env('JWT_REFRESH_TOKEN_TTL', 604800),

    // 记住我功能的刷新令牌有效期：默认30天（2592000秒）
    'refresh_token_remember_ttl' => env('JWT_REFRESH_TOKEN_REMEMBER_TTL', 2592000),

    // +----------------------------------------------------------------------
    // | 刷新令牌配置
    // +----------------------------------------------------------------------
    // 是否启用刷新令牌
    'enable_refresh_token' => env('JWT_ENABLE_REFRESH_TOKEN', true),

    // 刷新令牌长度（hash后的长度）
    'refresh_token_length' => 64,

    // +----------------------------------------------------------------------
    // | 黑名单配置
    // +----------------------------------------------------------------------
    // 是否启用令牌黑名单（用于注销功能）
    'enable_blacklist' => env('JWT_ENABLE_BLACKLIST', true),

    // 黑名单缓存前缀（Redis键前缀）
    'blacklist_prefix' => env('JWT_BLACKLIST_PREFIX', 'jwt:blacklist:'),

    // 黑名单缓存时长（秒）
    // 应该设置为访问令牌的最大有效期
    'blacklist_ttl' => env('JWT_BLACKLIST_TTL', 7200),

    // 黑名单缓存驱动（可选：redis, file, memcached等）
    // 留空则使用ThinkPHP默认缓存驱动
    'blacklist_cache' => env('JWT_BLACKLIST_CACHE', ''),

    // +----------------------------------------------------------------------
    // | 安全配置
    // +----------------------------------------------------------------------
    // 是否强制HTTPS（生产环境建议开启）
    'force_https' => env('JWT_FORCE_HTTPS', false),

    // 是否验证用户IP一致性（刷新令牌时）
    'verify_ip' => env('JWT_VERIFY_IP', false),

    // 是否验证User-Agent一致性（刷新令牌时）
    'verify_user_agent' => env('JWT_VERIFY_USER_AGENT', false),

    // 最大并发刷新令牌数（同一用户）
    // 超过此数量时，最早生成的令牌将被撤销
    'max_refresh_tokens' => env('JWT_MAX_REFRESH_TOKENS', 5),

    // +----------------------------------------------------------------------
    // | 性能配置
    // +----------------------------------------------------------------------
    // 是否启用缓存（缓存用户信息减少数据库查询）
    'enable_cache' => env('JWT_ENABLE_CACHE', true),

    // 用户信息缓存前缀
    'user_cache_prefix' => env('JWT_USER_CACHE_PREFIX', 'jwt:user:'),

    // 用户信息缓存时长（秒）
    'user_cache_ttl' => env('JWT_USER_CACHE_TTL', 3600),

    // +----------------------------------------------------------------------
    // | 错误处理配置
    // +----------------------------------------------------------------------
    // 是否在错误响应中返回详细错误信息
    'debug_errors' => env('JWT_DEBUG_ERRORS', false),

    // 自定义错误消息
    'error_messages' => [
        'token_not_found' => '令牌不存在',
        'token_expired' => '令牌已过期',
        'token_invalid' => '令牌无效',
        'token_blacklisted' => '令牌已撤销',
        'refresh_token_invalid' => '刷新令牌无效',
        'refresh_token_expired' => '刷新令牌已过期',
        'refresh_token_revoked' => '刷新令牌已撤销',
        'credentials_invalid' => '用户名或密码错误',
        'user_disabled' => '用户已被禁用',
        'user_banned' => '账号已被停用',
        'too_many_attempts' => '尝试次数过多，请稍后再试',
    ],

    // +----------------------------------------------------------------------
    // | 令牌载荷默认配置
    // +----------------------------------------------------------------------
    // 令牌类型标识
    'token_type_access' => 'access',
    'token_type_refresh' => 'refresh',

    // 是否包含用户详细信息
    'include_user_details' => env('JWT_INCLUDE_USER_DETAILS', true),
];
